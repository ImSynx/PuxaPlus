<header class="bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-end">
  <div class="flex items-center gap-4">
    <button class="text-gray-700 hover:text-purple-600 transition-colors" aria-label="Mensagens">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H7l-5 4V6c0-1.1.9-2 2-2z"></path>
      </svg>
    </button>
    <div class="relative" id="user-menu-container">
      <button 
        id="user-menu-button"
        class="text-gray-700 hover:text-purple-600 transition-colors focus:outline-none"
        aria-label="Perfil"
        aria-expanded="false"
        aria-haspopup="true"
      >
        <div class="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center overflow-hidden">
          {% set profile_pic_url = get_profile_picture_url(current_user) %}
          {% if profile_pic_url %}
            <img src="{{ profile_pic_url }}" alt="Foto de perfil" class="w-full h-full object-cover">
          {% else %}
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#7C3AED" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
              <circle cx="12" cy="7" r="4"></circle>
            </svg>
          {% endif %}
        </div>
      </button>
      
      <!-- Dropdown Menu -->
      <div 
        id="user-menu-dropdown"
        class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-1 z-50 hidden"
      >
        <div class="px-4 py-2 border-b border-gray-200">
          <p class="text-sm font-semibold text-gray-900">{{ current_user.username if current_user else 'Utilizador' }}</p>
          <p class="text-xs text-gray-500">{{ current_user.email if current_user else '' }}</p>
        </div>
        <a 
          href="{{ url_for('perfil') }}"
          class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition-colors"
        >
          Ver Perfil
        </a>
        <form method="POST" action="{{ url_for('logout') }}" class="block">
          <button 
            type="submit"
            class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors"
          >
            Logout
          </button>
        </form>
      </div>
    </div>
    
    <script>
      // Toggle dropdown menu
      document.addEventListener('DOMContentLoaded', function() {
        const button = document.getElementById('user-menu-button');
        const dropdown = document.getElementById('user-menu-dropdown');
        
        if (button && dropdown) {
          button.addEventListener('click', function(e) {
            e.stopPropagation();
            dropdown.classList.toggle('hidden');
            const isOpen = !dropdown.classList.contains('hidden');
            button.setAttribute('aria-expanded', isOpen);
          });
          
          // Close dropdown when clicking outside
          document.addEventListener('click', function(e) {
            if (!button.contains(e.target) && !dropdown.contains(e.target)) {
              dropdown.classList.add('hidden');
              button.setAttribute('aria-expanded', 'false');
            }
          });
        }
      });
    </script>
  </div>
</header>

